
<@box>
	<@boxHeader title='#i18n{identityimport.modify_candidateidentity.title}' />
	<@boxBody>
	
			<@messages errors=errors />
	   <@row >

		<div class="col-auto left-col">
			<@columns>
				<@table >
					<@tr>
						<@td>#i18n{identityimport.modify_candidateidentity.labelIdBatch} :</@td>
					</@tr>
					<@tr>
						<@td>#i18n{identityimport.modify_candidateidentity.labelConnectionId} :</@td>
					</@tr>
					<@tr>
						<@td>#i18n{identityimport.import_candidateidentity.labelCustomerId} :</@td>
					</@tr>
					<#list key_list as key >
						<@tr>
							<@td>${key!} :</@td>
						</@tr>
					</#list>
				</@table>
			</@columns >
		</div>
		<div class="col right-col d-flex flex-nowrap" style="overflow-x: auto">
			<@columns >
				<@table >
					<@tr>
						<@td>${identity.resource.idBatch!''}</@td>
					</@tr>
					<@tr>
						<@td>${identity.resource.connectionId!''}</@td>
					</@tr>
					<@tr>
						<@td>${identity.resource.customerId!''}</@td>
					</@tr>
					<#list key_list as key >
						<@tr>
							<#assign key_found = false>
							<#list identity.resource.attributes as attribute>
								<#if attribute.code??>
									<#if key == attribute.code>
										<@td>${attribute.value!}</@td>
										<#assign key_found = true>
									</#if>
								</#if>
							</#list>
							<#if key_found = false>
								<@td><i>Non défini</i></@td>
							</#if>
						</@tr>
					</#list>
					<@tr>
						<@td><i style="font-weight: bold">Candidat</i></@td>
					</@tr>
				</@table>
			</@columns >
			<#if duplicate_list?? && duplicate_list?size gt 0>
				<#list duplicate_list as duplicate >
					<@columns>
						<@input type="hidden" id="connection_id" name="connection_id" value="${duplicate.connectionId!''}"/>
						<@input type="hidden" id="customer_id" name="customer_id" value="${duplicate.customerId}"/>

						<@table >
							<@tr>
								<@td>
									${identity.resource.idBatch!''}
								</@td>
							</@tr>
							<@tr>
								<@td>
									${duplicate.connectionId!''}
								</@td>
							</@tr>
							<@tr>
								<@td>
									${duplicate.customerId!}
								</@td>
							</@tr>
							<#list key_list as key >
								<@tr>
									<#assign key_found = false>
									<#list duplicate.attributes as attribute>
										<#if key = attribute.key>
											<@td>${attribute.value!}</@td>
											<#assign key_found = true>
										</#if>
									</#list>
									<#if key_found = false>
										<@td><i>Non défini</i></@td>
									</#if>
								</@tr>
							</#list>
							<@tr>
								<td>
									<@aButton href='jsp/admin/plugins/identityimport/ManageCandidateIdentities.jsp?action=importCandidateIdentity&id=${identity.resource.id}&customer_id=${duplicate.customerId}' title='#i18n{portal.util.labelDownload}' hideTitle=['all'] buttonIcon='upload' />
								</td>
							</@tr>
						</@table>
					</@columns >
				</#list>
			</#if>
		</div>

		</@row>
    
	</@boxBody>
</@box>


<@box>
	<@boxHeader title='Workflow' />
	<@boxBody>
        
        statut : <#if identity.state??><@tag  color='warning'>${identity.state.name}</@tag><#else> not set</#if>

        <br>
        <br>
        
        <#if identity.actions??>actions :
			<#list identity.actions as action >
				<@aButton href="jsp/admin/plugins/identityimport/ManageCandidateIdentities.jsp?action=processWorkflowAction&action_id=${action.id}&id=${identity.resource.id}"
							title="${action.name}" alt="${action.name}"/>
				<!--  img src="image?resource_type=workflow_icon_img&id=${action.icon.id}" -->
				 </a>
			</#list>
		<#else>no action
		</#if>
		<#if return_url??>
			<@aButton href="${return_url}" title="#i18n{portal.util.labelCancel}" alt="#i18n{portal.util.labelCancel}"/>
		</#if>
		
		<br><br>
		History : ${identity.history! }

	</@boxBody>
</@box>
